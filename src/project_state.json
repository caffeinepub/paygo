{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 5,
  "summary": "PayGo: Billing Management System with role-based access, fixed sidebar UI rules, Indian ‚Çπ formatting, and modules for Users, Projects, Contractors, Bills (multi-step approval with debits), NMR weekly bills, Payments (partial payments), Dashboard, and Analytics. Target backend stack: FastAPI + PostgreSQL + SQLAlchemy + JWT + passlib.",
  "architectural_notes": [
    "Project name: PayGo (Billing Management System).",
    "Tech stack target: FastAPI (Python) backend, PostgreSQL DB, SQLAlchemy ORM, JWT auth, passlib password hashing, RBAC.",
    "Planned backend structure: main.py, database.py, models.py, schemas.py, auth.py, dependencies.py; routers for users/projects/contractors/bills/nmr/payments; utils for bill_number/payment_id/permissions.",
    "Key ID/number generators: User principal_id PG-USR-000001‚Ä¶; Bill number = <project first 2 letters> + running 3-digit; Payment ID = PDDMMYY###.",
    "Delete operations across modules require password '3554' (unmasked input; incorrect -> 'Incorrect password').",
    "Role rules: only Admin can access Users module; Site Engineer can raise bills; PM/QC/Billing Engineer approve at respective stages; Viewer view-only; main admin email forced Admin and is non-deletable/non-downgradeable.",
    "Formatting rule: all amounts display with ‚Çπ symbol and Indian number format (e.g., ‚Çπ 2,50,000).",
    "Resolve circular dependency by bootstrapping the main admin: on first successful Internet Identity login, if email==jogaraoseri.er@mktconstructions.com and no user exists for the principal_id, backend auto-creates the Admin user record (active) so Users module can be accessed."
  ],
  "known_issues": [
    "Conversation shows a platform constraint conflict previously (non-Python backend supported there); confirm deployment environment supports FastAPI/PostgreSQL stack.",
    "Circular dependency: only Admin can access Users module, but Admin user may not exist on first login; causes Create Profile/User not found for main admin until bootstrap logic is added."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-implement-authentication-and-session-handling-using-internet-identity-and-store-a-paygo-user-profile-mapped-to-the-authenticated-principal-including-name-email-mobile-role-active-status-and-generated-paygo-principal-id-block-access-when-the-user-is-deactivated-and-show-the-error-text-this-email-id-is-not-active",
      "title": "Implement authentication and session handling using Internet Identity, and store a PayGo user profile mapped to the authenticated Principal (including name, email, mobile, role, active status, and generated PayGo principal_id). Block access when the user is deactivated and show the error text: \"This email ID is not active.\"",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-build-the-users-module-with-role-based-access-control-only-admin-users-can-see-access-the-users-module-enforce-the-main-admin-rule-if-email-is-exactly-jogaraoseri-er-mktconstructions-com-then-role-is-always-admin-this-main-admin-user-cannot-be-deleted-and-cannot-be-downgraded-default-role-for-all-other-created-users-is-viewer-enforce-unique-email-and-unique-mobile-no-duplicate-records",
      "title": "Build the Users module with role-based access control: only Admin users can see/access the Users module. Enforce the main admin rule: if email is exactly \"jogaraoseri.er@mktconstructions.com\" then role is always Admin; this main admin user cannot be deleted and cannot be downgraded. Default role for all other created users is Viewer. Enforce unique email and unique mobile (no duplicate records).",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-the-global-ui-shell-and-navigation-fixed-left-sidebar-that-never-overlaps-content-always-visible-no-slide-animation-sidebar-footer-must-display-logged-in-user-name-email-id-a-role-badge-and-a-logout-button",
      "title": "Implement the global UI shell and navigation: fixed left sidebar that never overlaps content, always visible (no slide animation). Sidebar footer must display logged-in user name, email ID, a role badge, and a Logout button.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-enforce-the-delete-password-rule-across-all-modules-users-except-main-admin-protection-projects-contractors-bills-nmr-payments-any-delete-action-must-prompt-for-password-3554-with-input-not-masked-if-incorrect-show-the-exact-message-incorrect-password-and-do-not-delete",
      "title": "Enforce the delete-password rule across all modules (Users except main admin protection, Projects, Contractors, Bills, NMR, Payments): any delete action must prompt for password \"3554\" with input NOT masked; if incorrect, show the exact message: \"Incorrect password\" and do not delete.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-projects-module-crud-with-the-specified-fields-and-list-columns-project-fields-project-name-client-name-start-date-estimated-budget-contact-number-site-address-location-link-1-office-address-location-link-2-note-projects-list-columns-project-client-budget-start-date-status-actions-include-view-popup-edit-update-delete-password-protected",
      "title": "Implement Projects module CRUD with the specified fields and list columns. Project fields: Project Name, Client Name, Start Date, Estimated Budget, Contact Number, Site Address, Location Link 1, Office Address, Location Link 2, Note. Projects list columns: Project | Client | Budget | Start Date | Status | Actions. Include View (popup), Edit (update), Delete (password-protected).",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-contractors-module-crud-with-the-specified-fields-and-unit-dropdown-list-date-project-contractor-name-trade-manual-entry-unit-dropdown-unit-price-estimated-qty-estimated-amount-mobile-email-address-attachments-units-list-rft-sft-cuft-rmt-smt-cumt-pcs-nos-bundles-ltr-kg-ton-lumsum-the-contractors-list-page-must-include-filters-and-view-edit-delete-actions-delete-password-protected",
      "title": "Implement Contractors module CRUD with the specified fields and unit dropdown list: Date, Project, Contractor Name, Trade (manual entry), Unit (dropdown), Unit Price, Estimated Qty, Estimated Amount, Mobile, Email, Address, Attachments. Units list: Rft, Sft, Cuft, Rmt, Smt, Cumt, Pcs, Nos, Bundles, Ltr, Kg, Ton, Lumsum. The contractors list page must include filters and View/Edit/Delete actions (delete password-protected).",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-bills-module-with-bill-number-auto-generation-per-project-and-a-multi-step-approval-workflow-bill-number-format-first-2-letters-of-project-running-number-e-g-pv-001-tb-002-generated-after-selecting-a-project-and-sequential-per-project-prefix-new-bill-form-fields-contractor-project-project-date-trade-dropdown-from-contractor-master-unit-auto-from-contractor-unit-price-editable-quantity-total-unit-qty-description-location-authorized-engineer-auto-filled-logged-in-user-read-only-workflow-site-engineer-raises-bill-then-project-manager-approves-rejects-with-debit-note-then-qc-approves-rejects-with-debit-note-then-billing-engineer-final-approval-print-enabled-after-final-approval-debit-logic-final-amount-original-amount-pm-debit-qc-debit-status-strings-must-reflect-pipeline-states-e-g-pm-approved-qc-pending-qc-approved-billing-pending-completed",
      "title": "Implement Bills module with bill number auto-generation per project and a multi-step approval workflow. Bill number format: <First 2 Letters of Project> + running number (e.g., \"PV 001\", \"TB 002\"), generated after selecting a Project and sequential per project prefix. New Bill form fields: Contractor, Project, Project Date, Trade (dropdown from contractor master), Unit (auto from contractor), Unit Price (editable), Quantity, Total (Unit √ó Qty), Description, Location, Authorized Engineer (auto-filled logged-in user, read-only). Workflow: Site Engineer raises bill; then Project Manager approves/rejects with Debit + Note; then QC approves/rejects with Debit + Note; then Billing Engineer final approval; print enabled after final approval. Debit logic: Final Amount = Original Amount ‚Äì PM Debit ‚Äì QC Debit. Status strings must reflect pipeline states (e.g., \"PM Approved | QC Pending\", \"QC Approved | Billing Pending\", \"Completed\").",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-nmr-module-as-a-separate-module-not-inside-bills-for-weekly-bills-with-header-entry-table-and-weekly-only-save-rule-header-fields-project-contractor-trade-fixed-as-nmr-week-start-date-week-end-date-auto-calculated-as-start-6-days-engineer-name-auto-from-logged-in-user-entry-table-columns-date-labour-type-no-of-persons-rate-hours-duty-amount-allow-decimals-in-numeric-fields-e-g-1-25-1-5-save-rule-cannot-save-daily-entries-only-weekly-save-allowed-workflow-same-as-bills-pm-qc-billing",
      "title": "Implement NMR module as a separate module (not inside Bills) for weekly bills with header + entry table and weekly-only save rule. Header fields: Project, Contractor, Trade fixed as \"NMR\", Week Start Date, Week End Date auto-calculated as start + 6 days, Engineer Name auto from logged-in user. Entry table columns: Date | Labour Type | No. of Persons | Rate | Hours | Duty | Amount. Allow decimals in numeric fields (e.g., 1.25, 1.5). Save rule: cannot save daily entries; only weekly save allowed. Workflow same as Bills (PM ‚Üí QC ‚Üí Billing).",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-payments-module-with-multiple-payments-per-bill-payment-id-generation-and-payment-status-logic-payment-id-format-pddmmyy-e-g-p170126001-sequential-series-for-the-day-payment-form-bill-number-approved-only-payment-date-project-auto-contractor-auto-bill-total-read-only-paid-amount-balance-auto-status-logic-paid-0-pending-paid-total-partially-paid-paid-total-completed-ensure-multiple-payments-can-be-recorded-against-a-single-bill-and-aggregate-totals-for-status-balance",
      "title": "Implement Payments module with multiple payments per bill, payment ID generation, and payment status logic. Payment ID format: \"PDDMMYY###\" (e.g., \"P170126001\"), sequential series for the day. Payment form: Bill Number (approved only), Payment Date, Project (auto), Contractor (auto), Bill Total (read-only), Paid Amount, Balance (auto). Status logic: Paid = 0 ‚Üí Pending; Paid < Total ‚Üí Partially Paid; Paid >= Total ‚Üí Completed. Ensure multiple payments can be recorded against a single bill and aggregate totals for status/balance.",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-currency-display-rules-across-the-entire-frontend-all-monetary-amounts-must-show-the-symbol-and-use-indian-number-formatting-e-g-2-50-000",
      "title": "Implement currency display rules across the entire frontend: all monetary amounts must show the ‚Çπ symbol and use Indian number formatting (e.g., \"‚Çπ 2,50,000\").",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-dashboard-module-with-cards-and-graphs-cards-for-total-bills-completed-payments-pending-payments-total-paid-amount-graph-for-bills-vs-payments-filters-for-year-wise-and-project-wise-views",
      "title": "Implement Dashboard module with cards and graphs: cards for Total Bills, Completed Payments, Pending Payments, Total Paid Amount; graph for Bills vs Payments; filters for year-wise and project-wise views.",
      "reqIds": [
        "REQ-13"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-analytics-module-with-trade-wise-totals-top-3-summary-cards-and-filters-project-contractor-trade-year-date-range",
      "title": "Implement Analytics module with trade-wise totals, top 3 summary cards, and filters: Project | Contractor | Trade | Year | Date Range.",
      "reqIds": [
        "REQ-14"
      ],
      "version": 1
    },
    {
      "id": "feature-enforce-role-permissions-across-the-app-consistent-with-the-provided-access-summary-admin-raise-approve-delete-users-module-site-engineer-raise-only-project-manager-pm-approval-only-qc-qc-approval-only-billing-engineer-final-approval-only-viewer-view-only-hide-or-disable-ui-controls-the-user-cannot-use-and-also-enforce-the-same-permissions-on-the-backend-for-all-relevant-operations",
      "title": "Enforce role permissions across the app consistent with the provided access summary: Admin (raise/approve/delete/users module), Site Engineer (raise only), Project Manager (PM approval only), QC (QC approval only), Billing Engineer (final approval only), Viewer (view-only). Hide or disable UI controls the user cannot use, and also enforce the same permissions on the backend for all relevant operations.",
      "reqIds": [
        "REQ-15"
      ],
      "version": 1
    },
    {
      "id": "feature-apply-consistent-typography-and-a-coherent-visual-theme-for-the-entire-paygo-app-using-the-font-century-gothic-or-the-closest-available-web-safe-equivalent-fallback-if-unavailable-and-a-distinct-professional-construction-billing-inspired-style-avoid-blue-purple-as-the-default-palette",
      "title": "Apply consistent typography and a coherent visual theme for the entire PayGo app using the font \"Century Gothic\" (or the closest available web-safe equivalent/fallback if unavailable) and a distinct, professional construction/billing-inspired style (avoid blue/purple as the default palette).",
      "reqIds": [
        "REQ-16"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-generated-paygo-brand-image-asset-and-render-it-in-the-ui-e-g-in-the-sidebar-header-and-or-login-screen-from-static-assets-under-frontend-public-assets-generated-do-not-serve-images-via-the-backend",
      "title": "Add a generated PayGo brand image asset and render it in the UI (e.g., in the sidebar header and/or login screen) from static assets under frontend/public/assets/generated (do not serve images via the backend).",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-frontend-authentication-profile-gating-so-that-after-internet-identity-login-the-app-attempts-the-backend-main-admin-bootstrap-automatically-and-does-not-show-the-create-profile-screen-for-the-main-admin-bootstrap-case",
      "title": "Update the frontend authentication/profile gating so that, after Internet Identity login, the app attempts the backend main-admin bootstrap automatically and does not show the \"Create Profile\" screen for the main admin bootstrap case.",
      "reqIds": [
        "REQ-19"
      ],
      "version": 1
    },
    {
      "id": "feature-preserve-existing-behavior-for-non-admin-users-users-other-than-the-main-admin-must-still-be-created-by-an-admin-from-the-users-module-do-not-introduce-a-general-self-signup-self-profile-creation-bypass",
      "title": "Preserve existing behavior for non-admin users: users other than the main admin must still be created by an Admin from the Users module; do not introduce a general self-signup / self-profile-creation bypass.",
      "reqIds": [
        "REQ-20"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Global UI/settings: fixed left sidebar (no overlap), sidebar footer (user/email/role/logout), action icons (view/edit/delete), zebra rows, Indian ‚Çπ currency formatting, and delete actions protected by password 3554 (unmasked, error message on wrong).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "User Management module: admin-only visibility, main admin (jogaraoseri.er@mktconstructions.com) permanent/protected, default roles (main admin=Admin, others=Viewer), role management, principal ID auto-generate PG-USR-000001‚Ä¶, active/deactive toggle blocking login, and unique email/mobile validation.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Projects module: project CRUD with specified fields, list columns, view popup, edit update, delete with password.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Contractors module: contractor CRUD with specified fields (including attachments), units dropdown list, filters on list page, and actions (view/edit/delete).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-5",
      "summary": "Bills module: bill number auto-generation per project (first two letters + running number), bill form fields, engineer auto-filled, approval workflow (Site Engineer ‚Üí PM ‚Üí QC ‚Üí Billing Engineer), debit logic affecting final amount, status tracking, and print enabled after final approval.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "NMR module (weekly): separate from Bills, header fields (project/contractor/week start/end +6 days/engineer), entry table with decimals, weekly-only save rule, and same approval workflow as Bills.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "Payments module: payment ID format PDDMMYY###, payments against approved bills only, auto-fill project/contractor, balance calc, multiple payments per bill, and payment status logic (Pending/Partially Paid/Completed).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "Dashboard: cards (Total Bills, Completed Payments, Pending Payments, Total Paid Amount) and graphs (Bills vs Payments) with year-wise and project-wise filters.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-9",
      "summary": "Analytics: trade-wise totals, top-3 summary cards, and filters (Project, Contractor, Trade, Year, Date Range).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Generate and persist PayGo user principal IDs in the format \"PG-USR-000001\", \"PG-USR-000002\", ... unique and sequential across all users.",
      "reqIds": [
        "REQ-3"
      ],
      "status": "pending"
    },
    {
      "id": "AR-14",
      "summary": "Implement shared UI rules across all list pages and action controls: zebra/tiger row styling for tables/lists, and standardized action icons for View (üëÅ), Edit (‚úèÔ∏è), Delete (üóë) used consistently throughout the app.",
      "reqIds": [
        "REQ-5"
      ],
      "status": "pending"
    },
    {
      "id": "AR-15",
      "summary": "Bootstrap fix: auto-create the main admin user on first login via Internet Identity when email is jogaraoseri.er@mktconstructions.com and no user record exists (role=Admin, active=true). Do not show Create Profile/User not found for this email; keep normal behavior (admin must create users) for other emails.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-16",
      "summary": "Implement a backend bootstrap flow that auto-creates the main admin user when the first Internet Identity login occurs and there is no existing user record for that Principal. This must prevent the circular dependency where only an Admin can access the Users module but the Admin does not exist yet.",
      "reqIds": [
        "REQ-18"
      ],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "PayGo",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}